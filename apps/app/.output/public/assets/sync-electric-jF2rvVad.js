import{g as pt,S as qe,c as mt,a as vt,r as wt,j as F}from"./main-DJAnHGiT.js";import{S as bt,A as yt}from"./sidebar-7jcn3lOG.js";import{I as gt}from"./input-CFMIqzE9.js";import{fW as Ct}from"./button-BDX-2Pnw.js";import{C as _t}from"./checkbox-BbxIDuh8.js";import{T as Et,c as At,u as xt,e as St}from"./useLiveQuery-DgtjeeQe.js";import"./index-CLOoIZyZ.js";async function Ft(e,r){const n=e.getReader();let t;for(;!(t=await n.read()).done;)r(t.value)}function Pt(e){let r,n,t,s=!1;return function(o){r===void 0?(r=o,n=0,t=-1):r=Mt(r,o);const d=r.length;let f=0;for(;n<d;){s&&(r[n]===10&&(f=++n),s=!1);let l=-1;for(;n<d&&l===-1;++n)switch(r[n]){case 58:t===-1&&(t=n-f);break;case 13:s=!0;case 10:l=n;break}if(l===-1)break;e(r.subarray(f,l),t),f=n,t=-1}f===d?r=void 0:f!==0&&(r=r.subarray(f),n-=f)}}function Rt(e,r,n){let t=ke();const s=new TextDecoder;return function(o,d){if(o.length===0)n?.(t),t=ke();else if(d>0){const f=s.decode(o.subarray(0,d)),l=d+(o[d+1]===32?2:1),h=s.decode(o.subarray(l));switch(f){case"data":t.data=t.data?t.data+`
`+h:h;break;case"event":t.event=h;break;case"id":e(t.id=h);break;case"retry":const a=parseInt(h,10);isNaN(a)||r(t.retry=a);break}}}}function Mt(e,r){const n=new Uint8Array(e.length+r.length);return n.set(e),n.set(r,e.length),n}function ke(){return{data:"",event:"",id:"",retry:void 0}}var Ot=function(e,r){var n={};for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&r.indexOf(t)<0&&(n[t]=e[t]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,t=Object.getOwnPropertySymbols(e);s<t.length;s++)r.indexOf(t[s])<0&&Object.prototype.propertyIsEnumerable.call(e,t[s])&&(n[t[s]]=e[t[s]]);return n};const ge="text/event-stream",Tt=1e3,Ie="last-event-id";function kt(e,r){var{signal:n,headers:t,onopen:s,onmessage:i,onclose:o,onerror:d,openWhenHidden:f,fetch:l}=r,h=Ot(r,["signal","headers","onopen","onmessage","onclose","onerror","openWhenHidden","fetch"]);return new Promise((a,u)=>{const p=Object.assign({},t);p.accept||(p.accept=ge);let v;function E(){v.abort(),document.hidden||x()}f||document.addEventListener("visibilitychange",E);let g=Tt,_=0;function A(){document.removeEventListener("visibilitychange",E),window.clearTimeout(_),v.abort()}n?.addEventListener("abort",()=>{A(),a()});const R=l??window.fetch,S=s??It;async function x(){var Q;v=new AbortController;try{const I=await R(e,Object.assign(Object.assign({},h),{headers:p,signal:v.signal}));await S(I),await Ft(I.body,Pt(Rt(M=>{M?p[Ie]=M:delete p[Ie]},M=>{g=M},i))),o?.(),A(),a()}catch(I){if(!v.signal.aborted)try{const M=(Q=d?.(I))!==null&&Q!==void 0?Q:g;window.clearTimeout(_),_=window.setTimeout(x,M)}catch(M){A(),u(M)}}}x()})}function It(e){const r=e.headers.get("content-type");if(!r?.startsWith(ge))throw new Error(`Expected content-type to be ${ge}, Actual: ${r}`)}var Ut=Object.defineProperty,Dt=Object.defineProperties,jt=Object.getOwnPropertyDescriptors,ce=Object.getOwnPropertySymbols,Be=Object.prototype.hasOwnProperty,$e=Object.prototype.propertyIsEnumerable,Qe=e=>{throw TypeError(e)},Ue=(e,r,n)=>r in e?Ut(e,r,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[r]=n,B=(e,r)=>{for(var n in r||(r={}))Be.call(r,n)&&Ue(e,n,r[n]);if(ce)for(var n of ce(r))$e.call(r,n)&&Ue(e,n,r[n]);return e},Ce=(e,r)=>Dt(e,jt(r)),Ht=(e,r)=>{var n={};for(var t in e)Be.call(e,t)&&r.indexOf(t)<0&&(n[t]=e[t]);if(e!=null&&ce)for(var t of ce(e))r.indexOf(t)<0&&$e.call(e,t)&&(n[t]=e[t]);return n},_e=(e,r,n)=>r.has(e)||Qe("Cannot "+n),c=(e,r,n)=>(_e(e,r,"read from private field"),n?n.call(e):r.get(e)),w=(e,r,n)=>r.has(e)?Qe("Cannot add the same private member more than once"):r instanceof WeakSet?r.add(e):r.set(e,n),m=(e,r,n,t)=>(_e(e,r,"write to private field"),r.set(e,n),n),b=(e,r,n)=>(_e(e,r,"access private method"),n),C=(e,r,n)=>new Promise((t,s)=>{var i=f=>{try{d(n.next(f))}catch(l){s(l)}},o=f=>{try{d(n.throw(f))}catch(l){s(l)}},d=f=>f.done?t(f.value):Promise.resolve(f.value).then(i,o);d((n=n.apply(e,r)).next())}),te=class Ve extends Error{constructor(r,n,t,s,i,o){super(o||`HTTP Error ${r} at ${i}: ${n??JSON.stringify(t)}`),this.url=i,this.name="FetchError",this.status=r,this.text=n,this.json=t,this.headers=s}static fromResponse(r,n){return C(this,null,function*(){const t=r.status,s=Object.fromEntries([...r.headers.entries()]);let i,o;const d=r.headers.get("content-type");return r.bodyUsed||(d&&d.includes("application/json")?o=yield r.json():i=yield r.text()),new Ve(t,i,o,s,n)})}},ue=class extends Error{constructor(){super("Fetch with backoff aborted"),this.name="FetchBackoffAbortError"}},Lt=class extends Error{constructor(){super("Invalid shape options: missing required url parameter"),this.name="MissingShapeUrlError"}},Wt=class extends Error{constructor(){super("Invalid signal option. It must be an instance of AbortSignal."),this.name="InvalidSignalError"}},Nt=class extends Error{constructor(){super("shapeHandle is required if this isn't an initial fetch (i.e. offset > -1)"),this.name="MissingShapeHandleError"}},qt=class extends Error{constructor(e){super(`Cannot use reserved Electric parameter names in custom params: ${e.join(", ")}`),this.name="ReservedParamError"}},Bt=class extends Error{constructor(e){super(`Column "${e??"unknown"}" does not allow NULL values`),this.name="ParserNullValueError"}},$t=class extends Error{constructor(e,r){let n=`The response for the shape request to ${e} didn't include the following required headers:
`;r.forEach(t=>{n+=`- ${t}
`}),n+=`
This is often due to a proxy not setting CORS correctly so that all Electric headers can be read by the client.`,n+=`
For more information visit the troubleshooting guide: /docs/guides/troubleshooting/missing-headers`,super(n)}},oe=e=>Number(e),Qt=e=>e==="true"||e==="t",Vt=e=>BigInt(e),De=e=>JSON.parse(e),Yt=e=>e,Jt={int2:oe,int4:oe,int8:Vt,bool:Qt,float4:oe,float8:oe,json:De,jsonb:De};function zt(e,r){let n=0,t=null,s="",i=!1,o=0,d;function f(h,a,u){let p=h.slice(a,u);return p=p==="NULL"?null:p,r?r(p):p}function l(h){const a=[];for(;n<h.length;n++){if(t=h[n],i)t==="\\"?s+=h[++n]:t==='"'?(a.push(r?r(s):s),s="",i=h[n+1]==='"',o=n+2):s+=t;else if(t==='"')i=!0;else if(t==="{")o=++n,a.push(l(h));else if(t==="}"){i=!1,o<n&&a.push(f(h,o,n)),o=n+1;break}else t===","&&d!=="}"&&d!=='"'&&(a.push(f(h,o,n)),o=n+1);d=t}return o<n&&a.push(a.push(f(h,o,n+1))),a}return l(e)[0]}var Gt=class{constructor(e){this.parser=B(B({},Jt),e)}parse(e,r){return JSON.parse(e,(n,t)=>{if((n==="value"||n==="old_value")&&typeof t=="object"&&t!==null){const s=t;Object.keys(s).forEach(i=>{s[i]=this.parseRow(i,s[i],r)})}return t})}parseRow(e,r,n){var t;const s=n[e];if(!s)return r;const i=s,{type:o,dims:d}=i,f=Ht(i,["type","dims"]),l=(t=this.parser[o])!=null?t:Yt,h=je(l,s,e);return d&&d>0?je((u,p)=>zt(u,h),s,e)(r):h(r,f)}};function je(e,r,n){var t;const s=!((t=r.not_null)!=null&&t);return i=>{if(i===null){if(!s)throw new Bt(n??"unknown");return null}return e(i,r)}}function Ye(e){return"key"in e}function Ee(e){return!Ye(e)}function Je(e){return Ee(e)&&e.headers.control==="up-to-date"}function Kt(e){const r=e.headers.global_last_seen_lsn;if(r)return`${r}_0`}var Zt="electric-cursor",Ae="electric-handle",ze="electric-offset",Xt="electric-schema",er="electric-up-to-date",tr="columns",Ge="cursor",xe="handle",J="live",Se="offset",rr="table",nr="where",sr="replica",ir="params",ar="experimental_live_sse",Ke="force-disconnect-and-refresh",Ze="pause-stream",or=[429],Xe={initialDelay:100,maxDelay:1e4,multiplier:1.3};function lr(e,r=Xe){const{initialDelay:n,maxDelay:t,multiplier:s,debug:i=!1,onFailedAttempt:o}=r;return(...d)=>C(this,null,function*(){var f;const l=d[0],h=d[1];let a=n,u=0;for(;;)try{const p=yield e(...d);if(p.ok)return p;throw yield te.fromResponse(p,l.toString())}catch(p){if(o?.(),(f=h?.signal)!=null&&f.aborted)throw new ue;if(p instanceof te&&!or.includes(p.status)&&p.status>=400&&p.status<500)throw p;yield new Promise(v=>setTimeout(v,a)),a=Math.min(a*s,t),i&&(u++,console.log(`Retry attempt #${u} after ${a}ms`))}})}var cr=[201,204,205];function ur(e){return(...r)=>C(this,null,function*(){const n=r[0],t=yield e(...r);try{if(t.status<200||cr.includes(t.status))return t;const s=yield t.text();return new Response(s,t)}catch(s){throw new te(t.status,void 0,void 0,Object.fromEntries([...t.headers.entries()]),n.toString(),s instanceof Error?s.message:typeof s=="string"?s:"failed to read body")}})}var hr={maxChunksToPrefetch:2};function dr(e,r=hr){const{maxChunksToPrefetch:n}=r;let t;return(...i)=>C(this,null,function*(){const o=i[0].toString(),d=t?.consume(...i);if(d)return d;t?.abort();const f=yield e(...i),l=Fe(o,f);return l&&(t=new wr({fetchClient:e,maxPrefetchedRequests:n,url:l,requestInit:i[1]})),f})}var fr=["electric-offset","electric-handle"],pr=["electric-cursor"],mr=["electric-schema"];function vr(e){return(...r)=>C(this,null,function*(){const n=yield e(...r);if(n.ok){const t=n.headers,s=[],i=l=>s.push(...l.filter(h=>!t.has(h)));i(fr);const d=r[0].toString(),f=new URL(d);if(f.searchParams.get(J)==="true"&&i(pr),(!f.searchParams.has(J)||f.searchParams.get(J)==="false")&&i(mr),s.length>0)throw new $t(d,s)}return n})}var he,de,D,Y,j,Z,fe,wr=class{constructor(e){w(this,Z),w(this,he),w(this,de),w(this,D,new Map),w(this,Y),w(this,j);var r;m(this,he,(r=e.fetchClient)!=null?r:(...n)=>fetch(...n)),m(this,de,e.maxPrefetchedRequests),m(this,Y,e.url.toString()),m(this,j,c(this,Y)),b(this,Z,fe).call(this,e.url,e.requestInit)}abort(){c(this,D).forEach(([e,r])=>r.abort())}consume(...e){var r;const n=e[0].toString(),t=(r=c(this,D).get(n))==null?void 0:r[0];if(!(!t||n!==c(this,Y)))return c(this,D).delete(n),t.then(s=>{const i=Fe(n,s);m(this,Y,i),c(this,j)&&!c(this,D).has(c(this,j))&&b(this,Z,fe).call(this,c(this,j),e[1])}).catch(()=>{}),t}};he=new WeakMap;de=new WeakMap;D=new WeakMap;Y=new WeakMap;j=new WeakMap;Z=new WeakSet;fe=function(...e){var r,n;const t=e[0].toString();if(c(this,D).size>=c(this,de))return;const s=new AbortController;try{const{signal:i,cleanup:o}=br(s,(r=e[1])==null?void 0:r.signal),d=c(this,he).call(this,t,Ce(B({},(n=e[1])!=null?n:{}),{signal:i}));c(this,D).set(t,[d,s]),d.then(f=>{if(!f.ok||s.signal.aborted)return;const l=Fe(t,f);if(!l||l===t){m(this,j,void 0);return}return m(this,j,l),b(this,Z,fe).call(this,l,e[1])}).catch(()=>{}).finally(o)}catch{}};function Fe(e,r){const n=r.headers.get(Ae),t=r.headers.get(ze),s=r.headers.has(er);if(!n||!t||s)return;const i=new URL(e);if(!i.searchParams.has(J))return i.searchParams.set(xe,n),i.searchParams.set(Se,t),i.searchParams.sort(),i.toString()}function br(e,r){let n=yr;if(r)if(r.aborted)e.abort();else{const t=()=>e.abort();r.addEventListener("abort",t,{once:!0,signal:e.signal}),n=()=>r.removeEventListener("abort",t)}return{signal:e.signal,cleanup:n}}function yr(){}var gr=new Set([Ge,xe,J,Se]);function et(e){return C(this,null,function*(){return typeof e=="function"?e():e})}function Cr(e){return C(this,null,function*(){const r=Object.entries(e),n=yield Promise.all(r.map(t=>C(this,[t],function*([s,i]){if(i===void 0)return[s,void 0];const o=yield et(i);return[s,Array.isArray(o)?o.join(","):o]})));return Object.fromEntries(n.filter(([t,s])=>s!==void 0))})}function _r(e){return C(this,null,function*(){if(!e)return{};const r=Object.entries(e),n=yield Promise.all(r.map(t=>C(this,[t],function*([s,i]){return[s,yield et(i)]})));return Object.fromEntries(n)})}var pe,me,X,re,N,H,P,L,G,q,O,W,k,$,ne,T,z,U,se,ie,ee,y,ve,K,tt,rt,Pe,Re,nt,st,it,at,ot,lt,Me,ct,ut,Oe,ht=class{constructor(e){w(this,y),w(this,pe,null),w(this,me),w(this,X),w(this,re),w(this,N,new Map),w(this,H,!1),w(this,P,"active"),w(this,L),w(this,G),w(this,q),w(this,O,!1),w(this,W,!1),w(this,k),w(this,$),w(this,ne),w(this,T),w(this,z,!1),w(this,U),w(this,se),w(this,ie),w(this,ee,Promise.resolve([]));var r,n,t;this.options=B({subscribe:!0},e),Er(this.options),m(this,L,(r=this.options.offset)!=null?r:"-1"),m(this,G,""),m(this,k,this.options.handle),m(this,re,new Gt(e.parser)),m(this,ne,this.options.onError);const s=(n=e.fetchClient)!=null?n:(...d)=>fetch(...d),i=Ce(B({},(t=e.backoffOptions)!=null?t:Xe),{onFailedAttempt:()=>{var d,f;m(this,W,!1),(f=(d=e.backoffOptions)==null?void 0:d.onFailedAttempt)==null||f.call(d)}}),o=lr(s,i);m(this,X,vr(dr(o))),m(this,me,ur(c(this,X))),b(this,y,ut).call(this)}get shapeHandle(){return c(this,k)}get error(){return c(this,pe)}get isUpToDate(){return c(this,O)}get lastOffset(){return c(this,L)}subscribe(e,r=()=>{}){const n=Math.random();return c(this,N).set(n,[e,r]),c(this,H)||b(this,y,ve).call(this),()=>{c(this,N).delete(n)}}unsubscribeAll(){c(this,N).clear()}lastSyncedAt(){return c(this,q)}lastSynced(){return c(this,q)===void 0?1/0:Date.now()-c(this,q)}isConnected(){return c(this,W)}isLoading(){return!c(this,O)}hasStarted(){return c(this,H)}isPaused(){return c(this,P)==="paused"}forceDisconnectAndRefresh(){return C(this,null,function*(){var e,r;m(this,z,!0),c(this,O)&&!((e=c(this,T))!=null&&e.signal.aborted)&&((r=c(this,T))==null||r.abort(Ke)),yield b(this,y,lt).call(this),m(this,z,!1)})}};pe=new WeakMap;me=new WeakMap;X=new WeakMap;re=new WeakMap;N=new WeakMap;H=new WeakMap;P=new WeakMap;L=new WeakMap;G=new WeakMap;q=new WeakMap;O=new WeakMap;W=new WeakMap;k=new WeakMap;$=new WeakMap;ne=new WeakMap;T=new WeakMap;z=new WeakMap;U=new WeakMap;se=new WeakMap;ie=new WeakMap;ee=new WeakMap;y=new WeakSet;ve=function(){return C(this,null,function*(){var e;m(this,H,!0);try{yield b(this,y,K).call(this)}catch(r){if(m(this,pe,r),c(this,ne)){const n=yield c(this,ne).call(this,r);typeof n=="object"&&(b(this,y,Oe).call(this),"params"in n&&(this.options.params=n.params),"headers"in n&&(this.options.headers=n.headers),m(this,H,!1),b(this,y,ve).call(this));return}throw r}finally{m(this,W,!1),(e=c(this,ie))==null||e.call(this)}})};K=function(){return C(this,null,function*(){var e,r;if(c(this,P)==="pause-requested"){m(this,P,"paused");return}if(!this.options.subscribe&&((e=this.options.signal)!=null&&e.aborted||c(this,O)))return;const n=c(this,P)==="paused";m(this,P,"active");const{url:t,signal:s}=this.options,{fetchUrl:i,requestHeaders:o}=yield b(this,y,tt).call(this,t,n),d=yield b(this,y,rt).call(this,s),f=c(this,T);try{yield b(this,y,nt).call(this,{fetchUrl:i,requestAbortController:f,headers:o,resumingFromPause:n})}catch(l){if((l instanceof te||l instanceof ue)&&f.signal.aborted&&f.signal.reason===Ke)return b(this,y,K).call(this);if(l instanceof ue){f.signal.aborted&&f.signal.reason===Ze&&m(this,P,"paused");return}if(!(l instanceof te))throw l;if(l.status==409){const h=l.headers[Ae]||`${c(this,k)}-next`;return b(this,y,Oe).call(this,h),yield b(this,y,Me).call(this,l.json),b(this,y,K).call(this)}else throw b(this,y,ct).call(this,l),l}finally{d&&s&&s.removeEventListener("abort",d),m(this,T,void 0)}return(r=c(this,se))==null||r.call(this),b(this,y,K).call(this)})};tt=function(e,r){return C(this,null,function*(){const[n,t]=yield Promise.all([_r(this.options.headers),this.options.params?Cr(Ar(this.options.params)):void 0]);t&&dt(t);const s=new URL(e);if(t){t.table&&V(s,rr,t.table),t.where&&V(s,nr,t.where),t.columns&&V(s,tr,t.columns),t.replica&&V(s,sr,t.replica),t.params&&V(s,ir,t.params);const i=B({},t);delete i.table,delete i.where,delete i.columns,delete i.replica,delete i.params;for(const[o,d]of Object.entries(i))V(s,o,d)}return s.searchParams.set(Se,c(this,L)),c(this,O)&&(!c(this,z)&&!r&&s.searchParams.set(J,"true"),s.searchParams.set(Ge,c(this,G))),c(this,k)&&s.searchParams.set(xe,c(this,k)),s.searchParams.sort(),{fetchUrl:s,requestHeaders:n}})};rt=function(e){return C(this,null,function*(){var r;if(m(this,T,new AbortController),e){const n=()=>{var t;(t=c(this,T))==null||t.abort(e.reason)};return e.addEventListener("abort",n,{once:!0}),e.aborted&&((r=c(this,T))==null||r.abort(e.reason)),n}})};Pe=function(e){return C(this,null,function*(){var r;const{headers:n,status:t}=e,s=n.get(Ae);s&&m(this,k,s);const i=n.get(ze);i&&m(this,L,i);const o=n.get(Zt);o&&m(this,G,o);const d=()=>{const f=n.get(Xt);return f?JSON.parse(f):{}};m(this,$,(r=c(this,$))!=null?r:d()),t===204&&m(this,q,Date.now())})};Re=function(e,r=!1){return C(this,null,function*(){if(e.length>0){const n=e[e.length-1];if(Je(n)){if(r){const t=Kt(n);t&&m(this,L,t)}m(this,q,Date.now()),m(this,O,!0)}yield b(this,y,Me).call(this,e)}})};nt=function(e){return C(this,null,function*(){return c(this,O)&&this.options.experimentalLiveSse&&!c(this,z)&&!e.resumingFromPause?(e.fetchUrl.searchParams.set(ar,"true"),b(this,y,it).call(this,e)):b(this,y,st).call(this,e)})};st=function(e){return C(this,null,function*(){const{fetchUrl:r,requestAbortController:n,headers:t}=e,s=yield c(this,me).call(this,r.toString(),{signal:n.signal,headers:t});m(this,W,!0),yield b(this,y,Pe).call(this,s);const i=c(this,$),d=(yield s.text())||"[]",f=c(this,re).parse(d,i);yield b(this,y,Re).call(this,f)})};it=function(e){return C(this,null,function*(){const{fetchUrl:r,requestAbortController:n,headers:t}=e,s=c(this,X);try{let i=[];yield kt(r.toString(),{headers:t,fetch:s,onopen:o=>C(this,null,function*(){m(this,W,!0),yield b(this,y,Pe).call(this,o)}),onmessage:o=>{if(o.data){const d=c(this,$),f=c(this,re).parse(o.data,d);i.push(f),Je(f)&&(b(this,y,Re).call(this,i,!0),i=[])}},onerror:o=>{throw o},signal:n.signal})}catch(i){throw n.signal.aborted?new ue:i}})};at=function(){var e;c(this,H)&&c(this,P)==="active"&&(m(this,P,"pause-requested"),(e=c(this,T))==null||e.abort(Ze))};ot=function(){c(this,H)&&c(this,P)==="paused"&&b(this,y,ve).call(this)};lt=function(){return C(this,null,function*(){return c(this,U)?c(this,U):(m(this,U,new Promise((e,r)=>{m(this,se,e),m(this,ie,r)})),c(this,U).finally(()=>{m(this,U,void 0),m(this,se,void 0),m(this,ie,void 0)}),c(this,U))})};Me=function(e){return C(this,null,function*(){return m(this,ee,c(this,ee).then(()=>Promise.all(Array.from(c(this,N).values()).map(r=>C(this,[r],function*([n,t]){try{yield n(e)}catch(s){queueMicrotask(()=>{throw s})}}))))),c(this,ee)})};ct=function(e){c(this,N).forEach(([r,n])=>{n?.(e)})};ut=function(){if(typeof document=="object"&&typeof document.hidden=="boolean"&&typeof document.addEventListener=="function"){const e=()=>{document.hidden?b(this,y,at).call(this):b(this,y,ot).call(this)};document.addEventListener("visibilitychange",e)}};Oe=function(e){m(this,L,"-1"),m(this,G,""),m(this,k,e),m(this,O,!1),m(this,W,!1),m(this,$,void 0)};ht.Replica={FULL:"full",DEFAULT:"default"};function dt(e){if(!e)return;const r=Object.keys(e).filter(n=>gr.has(n));if(r.length>0)throw new qt(r)}function Er(e){if(!e.url)throw new Lt;if(e.signal&&!(e.signal instanceof AbortSignal))throw new Wt;if(e.offset!==void 0&&e.offset!=="-1"&&!e.handle)throw new Nt;dt(e.params)}function V(e,r,n){if(!(n===void 0||n==null))if(typeof n=="string")e.searchParams.set(r,n);else if(typeof n=="object")for(const[t,s]of Object.entries(n))e.searchParams.set(`${r}[${t}]`,s);else e.searchParams.set(r,n.toString())}function Ar(e){return Array.isArray(e.params)?Ce(B({},e),{params:Object.fromEntries(e.params.map((r,n)=>[n+1,r]))}):e}var le={exports:{}},be,He;function xr(){if(He)return be;He=1;var e=1e3,r=e*60,n=r*60,t=n*24,s=t*7,i=t*365.25;be=function(h,a){a=a||{};var u=typeof h;if(u==="string"&&h.length>0)return o(h);if(u==="number"&&isFinite(h))return a.long?f(h):d(h);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(h))};function o(h){if(h=String(h),!(h.length>100)){var a=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(h);if(a){var u=parseFloat(a[1]),p=(a[2]||"ms").toLowerCase();switch(p){case"years":case"year":case"yrs":case"yr":case"y":return u*i;case"weeks":case"week":case"w":return u*s;case"days":case"day":case"d":return u*t;case"hours":case"hour":case"hrs":case"hr":case"h":return u*n;case"minutes":case"minute":case"mins":case"min":case"m":return u*r;case"seconds":case"second":case"secs":case"sec":case"s":return u*e;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return u;default:return}}}}function d(h){var a=Math.abs(h);return a>=t?Math.round(h/t)+"d":a>=n?Math.round(h/n)+"h":a>=r?Math.round(h/r)+"m":a>=e?Math.round(h/e)+"s":h+"ms"}function f(h){var a=Math.abs(h);return a>=t?l(h,a,t,"day"):a>=n?l(h,a,n,"hour"):a>=r?l(h,a,r,"minute"):a>=e?l(h,a,e,"second"):h+" ms"}function l(h,a,u,p){var v=a>=u*1.5;return Math.round(h/u)+" "+p+(v?"s":"")}return be}var ye,Le;function Sr(){if(Le)return ye;Le=1;function e(r){t.debug=t,t.default=t,t.coerce=l,t.disable=d,t.enable=i,t.enabled=f,t.humanize=xr(),t.destroy=h,Object.keys(r).forEach(a=>{t[a]=r[a]}),t.names=[],t.skips=[],t.formatters={};function n(a){let u=0;for(let p=0;p<a.length;p++)u=(u<<5)-u+a.charCodeAt(p),u|=0;return t.colors[Math.abs(u)%t.colors.length]}t.selectColor=n;function t(a){let u,p=null,v,E;function g(..._){if(!g.enabled)return;const A=g,R=Number(new Date),S=R-(u||R);A.diff=S,A.prev=u,A.curr=R,u=R,_[0]=t.coerce(_[0]),typeof _[0]!="string"&&_.unshift("%O");let x=0;_[0]=_[0].replace(/%([a-zA-Z%])/g,(I,M)=>{if(I==="%%")return"%";x++;const Te=t.formatters[M];if(typeof Te=="function"){const ft=_[x];I=Te.call(A,ft),_.splice(x,1),x--}return I}),t.formatArgs.call(A,_),(A.log||t.log).apply(A,_)}return g.namespace=a,g.useColors=t.useColors(),g.color=t.selectColor(a),g.extend=s,g.destroy=t.destroy,Object.defineProperty(g,"enabled",{enumerable:!0,configurable:!1,get:()=>p!==null?p:(v!==t.namespaces&&(v=t.namespaces,E=t.enabled(a)),E),set:_=>{p=_}}),typeof t.init=="function"&&t.init(g),g}function s(a,u){const p=t(this.namespace+(typeof u>"u"?":":u)+a);return p.log=this.log,p}function i(a){t.save(a),t.namespaces=a,t.names=[],t.skips=[];const u=(typeof a=="string"?a:"").trim().replace(/\s+/g,",").split(",").filter(Boolean);for(const p of u)p[0]==="-"?t.skips.push(p.slice(1)):t.names.push(p)}function o(a,u){let p=0,v=0,E=-1,g=0;for(;p<a.length;)if(v<u.length&&(u[v]===a[p]||u[v]==="*"))u[v]==="*"?(E=v,g=p,v++):(p++,v++);else if(E!==-1)v=E+1,g++,p=g;else return!1;for(;v<u.length&&u[v]==="*";)v++;return v===u.length}function d(){const a=[...t.names,...t.skips.map(u=>"-"+u)].join(",");return t.enable(""),a}function f(a){for(const u of t.skips)if(o(a,u))return!1;for(const u of t.names)if(o(a,u))return!0;return!1}function l(a){return a instanceof Error?a.stack||a.message:a}function h(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return t.enable(t.load()),t}return ye=e,ye}var We;function Fr(){return We||(We=1,(function(e,r){var n={};r.formatArgs=s,r.save=i,r.load=o,r.useColors=t,r.storage=d(),r.destroy=(()=>{let l=!1;return()=>{l||(l=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),r.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function t(){if(typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))return!0;if(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let l;return typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&(l=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(l[1],10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function s(l){if(l[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+l[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;const h="color: "+this.color;l.splice(1,0,h,"color: inherit");let a=0,u=0;l[0].replace(/%[a-zA-Z%]/g,p=>{p!=="%%"&&(a++,p==="%c"&&(u=a))}),l.splice(u,0,h)}r.log=console.debug||console.log||(()=>{});function i(l){try{l?r.storage.setItem("debug",l):r.storage.removeItem("debug")}catch{}}function o(){let l;try{l=r.storage.getItem("debug")||r.storage.getItem("DEBUG")}catch{}return!l&&typeof process<"u"&&"env"in process&&(l=n.DEBUG),l}function d(){try{return localStorage}catch{}}e.exports=Sr()(r);const{formatters:f}=e.exports;f.j=function(l){try{return JSON.stringify(l)}catch(h){return"[UnexpectedJSONParseError]: "+h.message}}})(le,le.exports)),le.exports}var Pr=Fr();const Rr=pt(Pr);class ae extends Et{constructor(r){super(r),this.name="ElectricDBCollectionError"}}class Mr extends ae{constructor(r){super(`Expected number in awaitTxId, received ${r}`),this.name="ExpectedNumberInAwaitTxIdError"}}class Or extends ae{constructor(r){super(`Timeout waiting for txId: ${r}`),this.name="TimeoutWaitingForTxIdError"}}class Tr extends ae{constructor(){super("Electric collection onInsert handler must return a txid or array of txids"),this.name="ElectricInsertHandlerMustReturnTxIdError"}}class kr extends ae{constructor(){super("Electric collection onUpdate handler must return a txid or array of txids"),this.name="ElectricUpdateHandlerMustReturnTxIdError"}}class Ir extends ae{constructor(){super("Electric collection onDelete handler must return a txid or array of txids"),this.name="ElectricDeleteHandlerMustReturnTxIdError"}}const we=Rr.debug("ts/db:electric");function Ur(e){return Ee(e)&&e.headers.control==="up-to-date"}function Dr(e){return Ee(e)&&e.headers.control==="must-refetch"}function jr(e){return"txids"in e.headers&&Array.isArray(e.headers.txids)}function Hr(e){const r=new qe(new Set([])),n=Lr(e.shapeOptions,{seenTxids:r}),t=async(u,p=3e4)=>{if(we("awaitTxId called with txid %d",u),typeof u!="number")throw new Mr(typeof u);return r.state.has(u)?!0:new Promise((E,g)=>{const _=setTimeout(()=>{A(),g(new Or(u))},p),A=r.subscribe(()=>{r.state.has(u)&&(we("awaitTxId found match for txid %o",u),clearTimeout(_),A(),E(!0))})})},s=e.onInsert?async u=>{const p=await e.onInsert(u)??{},v=p.txid;if(!v)throw new Tr;return Array.isArray(v)?await Promise.all(v.map(E=>t(E))):await t(v),p}:void 0,i=e.onUpdate?async u=>{const p=await e.onUpdate(u)??{},v=p.txid;if(!v)throw new kr;return Array.isArray(v)?await Promise.all(v.map(E=>t(E))):await t(v),p}:void 0,o=e.onDelete?async u=>{const p=await e.onDelete(u);if(!p.txid)throw new Ir;return Array.isArray(p.txid)?await Promise.all(p.txid.map(v=>t(v))):await t(p.txid),p}:void 0,{shapeOptions:d,onInsert:f,onUpdate:l,onDelete:h,...a}=e;return{...a,sync:n,onInsert:s,onUpdate:i,onDelete:o,utils:{awaitTxId:t}}}function Lr(e,r){const{seenTxids:n}=r,t=new qe(void 0),s=()=>{var d;const f=t.state||"public";return{relation:(d=e.params)!=null&&d.table?[f,e.params.table]:void 0}},i=new AbortController;e.signal&&(e.signal.addEventListener("abort",()=>{i.abort()}),e.signal.aborted&&i.abort());let o;return{sync:d=>{const{begin:f,write:l,commit:h,markReady:a,truncate:u,collection:p}=d,v=new ht({...e,signal:i.signal,onError:_=>{if(a(),e.onError)return e.onError(_);console.error(`An error occurred while syncing collection: ${p.id}, 
it has been marked as ready to avoid blocking apps waiting for '.preload()' to finish. 
You can provide an 'onError' handler on the shapeOptions to handle this error, and this message will not be logged.`,_)}});let E=!1;const g=new Set;return o=v.subscribe(_=>{var A;let R=!1;for(const S of _)if(jr(S)&&((A=S.headers.txids)==null||A.forEach(x=>g.add(x))),Ye(S)){const x=S.headers.schema;x&&typeof x=="string"&&t.setState(()=>x),E||(f(),E=!0),l({type:S.headers.operation,value:S.value,metadata:{...S.headers}})}else Ur(S)?R=!0:Dr(S)&&(we("Received must-refetch message, starting transaction with truncate"),E||(f(),E=!0),u(),R=!1);R&&(E&&(h(),E=!1),a(),n.setState(S=>{const x=new Set(S);return g.size>0&&we("new txids synced from pg %O",Array.from(g)),g.forEach(Q=>x.add(Q)),g.clear(),x}))}),()=>{o(),i.abort()}},getSyncMetadata:s}}const Ne=At(Hr({shapeOptions:{url:"http://localhost:3000/api/shapes/todos",onError:e=>{console.error("error",e)}},getKey:e=>e.id,onInsert:async({transaction:e})=>{const{modified:r}=e.mutations[0],{id:n}=await mt({data:{title:r.title}});return{txid:n}}}));function Yr(){const{user:e}=vt.useLoaderData(),{data:r}=xt(i=>i.from({todo:Ne}).where(({todo:o})=>St(o.completed,!1)).orderBy(({todo:o})=>o.created_at,"desc"));console.log(r);const[n,t]=wt.useState(""),s=i=>{i.preventDefault(),Ne.insert({id:crypto.randomUUID(),created_at:new Date,completed:!1,user_id:e.id,title:n}),t("")};return F.jsxs(bt,{children:[F.jsx(yt,{}),F.jsxs("main",{className:"p-4",children:[F.jsx("h1",{className:"text-2xl font-bold",children:"Sync with Electric"}),F.jsx("p",{className:"mb-4",children:"A simple todo list built with Electric SQL."}),F.jsx("div",{className:"mb-4",children:r.map(i=>F.jsxs("div",{className:"flex items-center gap-2",children:[F.jsx(_t,{}),F.jsx("span",{children:i.title})]},i.id))}),F.jsxs("form",{onSubmit:s,className:"flex gap-2 p-3 bg-muted w-full rounded-lg",children:[F.jsx(gt,{value:n,onChange:i=>t(i.target.value),className:"bg-white"}),F.jsx(Ct,{type:"submit",children:"Add"})]})]})]})}export{Yr as component};
